{"version":3,"sources":["../../src/pages/shift/shift-form/shift-form.module.ts","../../src/pages/shift/shift-form/shift-form.ts"],"names":[],"mappings":"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","file":"29.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ShiftForm } from './shift-form';\n\n@NgModule({\n  declarations: [\n    ShiftForm,\n  ],\n  imports: [\n    IonicPageModule.forChild(ShiftForm),\n  ],\n  exports: [\n    ShiftForm,\n  ]\n})\nexport class ShiftFormModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/shift/shift-form/shift-form.module.ts","import { IonicPage, NavController, NavParams, AlertController, ToastController, LoadingController } from 'ionic-angular';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { Component, ViewChild } from '@angular/core';\nimport { BarcodeScanner } from '@ionic-native/barcode-scanner/ngx';\nimport * as moment from 'moment';\nimport { ShiftApi } from '../../../providers/shift-api';\nimport { ResponseUtility } from '../../../providers/response-utility';\n\n@IonicPage()\n@Component({\n  selector: 'page-shift-form',\n  templateUrl: 'shift-form.html',\n})\nexport class ShiftForm {\n\n  shift: {};\n  care_home: {};\n  @ViewChild('signupSlider') signupSlider: any;\n\n  slideOneForm: FormGroup;\n  submitAttempt: boolean = false;\n  start_code_present = false;\n\n  constructor(public navCtrl: NavController,\n    public navParams: NavParams,\n    public formBuilder: FormBuilder,\n    public loadingController: LoadingController,\n    public shiftApi: ShiftApi,\n    public respUtility: ResponseUtility,\n    private barcodeScanner: BarcodeScanner) {\n\n    this.shift = this.navParams.data;\n    this.care_home = this.shift[\"care_home\"];\n    console.log(this.shift);\n    this.start_code_present = this.shift[\"start_code\"] != null\n\n    this.slideOneForm = formBuilder.group({\n\n      start_code: ['', Validators.compose([Validators.maxLength(30)])],\n      end_code: ['', Validators.compose([Validators.maxLength(30)])]\n\n    });\n\n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad ShiftForm');\n    this.respUtility.trackView(\"ShiftForm\");\n  }\n\n  scan() {\n    console.log('Scan called');\n    this.barcodeScanner.scan().then(qr_code => {\n       console.log('qr_code', qr_code);\n\n      let loader = this.loadingController.create({\n        content: 'Saving ...'\n      });\n      loader.present();\n\n      this.shiftApi.startEndShift(this.shift[\"id\"], qr_code.text).map(res => {\n        console.log(`Shift = ${res}`);\n        this.shift = res;\n      }).subscribe(\n        shift => {          \n          if (this.shift[\"end_code\"] != null) {\n            this.respUtility.showSuccess('Code Accepted.Your shift has ended.');\n            this.navCtrl.pop();\n            this.navCtrl.pop();\n            this.rate_care_home(this.shift);\n          } else {\n            this.respUtility.showSuccess('Code Accepted.Your shift has started.');\n            this.navCtrl.pop();\n            this.navCtrl.pop();\n          }\n        },\n        error => {\n          if (error.status === 422) {\n            let error_response = error.error;\n            let msg = \"\";\n            for (var key in error_response) {\n              msg += error_response[key] + \". \";\n            }\n            this.respUtility.showWarning(msg);\n            loader.dismiss();\n          }\n          else {\n            this.respUtility.showFailure(error);\n            loader.dismiss();\n          }\n        },\n        () => { loader.dismiss(); }\n      );\n\n    }).catch(err => {\n      console.log('Error', err);\n    });\n  }\n\n  isAcceptedResponse() {\n    return this.shift[\"response_status\"] == \"Accepted\";\n  }\n\n  confirmSave() {\n    let message = \"\";\n    if (this.shift[\"start_code\"] && this.shift[\"end_code\"] == null) {\n      message = \"This will start your shift and set the shift start time to now. Start shift now?\";\n    } else {\n      let duration = moment.duration(moment().diff(moment(this.shift[\"start_date\"])));\n      if (duration.asHours() > 4) {\n        message = \"This will end your shift and set the shift end time to now. End shift now? \";\n      } else {\n        message = \"This will end your shift now but set the shift end time to 4 hours from the start time,\" +\n          \"as the minumum shift duration is 4 hours. End shift now? \";\n      }\n    }\n\n    this.respUtility.confirmAction(this.save.bind(this), null, message);\n  }\n\n\n  rate_care_home(shift) {\n    let rating = {\n      staffing_request_id: shift.staffing_request_id,\n      rated_entity_id: shift.care_home_id,\n      rated_entity_type: \"CareHome\",\n      care_home_id: shift.care_home_id,\n      shift_id: shift.id,\n      comments: \"Thank you.\"\n    }\n    this.navCtrl.push('RatingForm', rating);\n  }\n\n  save() {\n\n    this.submitAttempt = true;\n    //console.log(this.shift);\n    let loader = this.loadingController.create({\n      content: 'Saving ...'\n    });\n\n    if (!this.slideOneForm.valid) {\n\n    }\n    else {\n      this.submitAttempt = false;\n      loader.present();\n\n      if (this.shift[\"id\"]) {\n        this.shiftApi.updateShift(this.shift).map(res => {\n          console.log(`Shift = ${res}`);\n          this.shift = res;\n        }).subscribe(\n          shift => {\n            if (this.shift[\"end_code\"] != null) {\n              this.respUtility.trackEvent(\"Shift\", \"Ended\", \"click\");\n              this.respUtility.showSuccess('Code Accepted.Your shift has ended.');\n              this.navCtrl.pop();\n              this.rate_care_home(this.shift);\n            } else {\n              this.respUtility.trackEvent(\"Shift\", \"Started\", \"click\");\n              this.respUtility.showSuccess('Code Accepted.Your shift has started.');\n              this.navCtrl.pop();\n            }\n\n\n          },\n          error => {\n            if (error.status === 422) {\n              let error_response = error.error;\n              let msg = \"\";\n              for (var key in error_response) {\n                msg += error_response[key] + \". \";\n              }\n              this.respUtility.showWarning(msg);\n              loader.dismiss();\n            }\n            else {\n              this.respUtility.showFailure(error);\n              loader.dismiss();\n            }\n          },\n          () => { loader.dismiss(); }\n        );\n      } else {\n        this.shiftApi.createShift(this.shift).subscribe(\n          shift => {\n            this.respUtility.showSuccess('Shift saved successfully.');\n            this.navCtrl.pop();\n          },\n          error => {\n            this.respUtility.showFailure(error);\n            loader.dismiss();\n          },\n          () => { loader.dismiss(); }\n        );\n      }\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/shift/shift-form/shift-form.ts"],"sourceRoot":""}